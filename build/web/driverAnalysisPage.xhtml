<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Autocross DB</title>
    </h:head>
    <h:body>
        <f:facet name="last">
            <h:outputStylesheet name="css/autoxDbMainStyle.css"  />
        </f:facet>
        <p:layout fullPage="true">
            <p:layoutUnit position="north" size="100">
                <p:tabMenu activeIndex="#{param.i}">
                    <p:menuitem value="Home" outcome="index">
                        <f:param name="i" value="0"/>
                    </p:menuitem>
                    <p:menuitem value="Event Info" outcome="eventInfoPage">
                        <f:param name="i" value="1"/>
                    </p:menuitem>
                    <p:menuitem value="New Event" outcome="loadEventPage">
                        <f:param name="i" value="2"/>
                    </p:menuitem>
                    <p:menuitem value="Chart" outcome="comparisonChart">
                        <f:param name="i" value="3" />
                    </p:menuitem>
                    <p:menuitem value="Individual Awards" outcome="awardsPage" >
                        <f:param name="i" value="4" />
                    </p:menuitem>
                    <p:menuitem value="Event Awards" outcome="eventAwardsPage" >
                        <f:param name="i" value="5" />
                    </p:menuitem>
                    <p:menuitem value="Analysis" outcome="driverAnalysisPage" >
                        <f:param name="i" value="6" />
                    </p:menuitem>
                </p:tabMenu> 
            </p:layoutUnit>
            <p:layoutUnit position="west" size="400">
                <h:form id="analysisForm">
                    <p:panelGrid columns="2" styleClass="noOutlinePanelGrid">
                        <p:outputLabel value="Driver:" />
                        <p:autoComplete id="driver" forceSelection="true" required="true" value="#{driverAnalysis.driver}" completeMethod="#{driverAnalysis.completeDriverText}" />
                        <p:outputLabel value="Start Date:" />
                        <p:calendar id="start" mode="popup" required="true" value="#{driverAnalysis.startDate}" />
                        <p:outputLabel value="End Date:" />
                        <p:calendar id="end" mode="popup" required="true" value="#{driverAnalysis.endDate}" />
                        <p:commandButton value="Analyze" update="analysisForm analysisCarousel" action="#{driverAnalysis.analyzeDriver}" />
                    </p:panelGrid>
                </h:form>
            </p:layoutUnit>
            <p:layoutUnit position="center">
                <p:carousel id="analysisCarousel" value="#{driverAnalysis.events}" var="event" itemStyle="text-align:center;" numVisible="4" responsive="true" headerText="#{driverAnalysis.driver ne null and driverAnalysis.driver ne '' ? 'Events for '.concat(driverAnalysis.driver) : ''}" >
                    <p:panelGrid columns="2" columnClasses="descriptionColumn">
                        <h:outputText value="Event: " />
                        <h:outputText value="#{event.eventName}" />
                        <h:outputText value="Your Car: " />
                        <h:outputText value="#{event.carName}" />
                        <h:outputText value="Your Class: " />
                        <h:outputText value="#{event.className}" />
                        <h:outputText value="Class Position: " />
                        <p:commandLink oncomplete="PF('classDetailsOP').show()" update="classDetails">
                            <h:outputText value="#{event.classPosition}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                        <h:outputText value="Raw Position: " />
                        <p:commandLink oncomplete="PF('rawDetailsOP').show()" update="rawDetails">
                            <h:outputText value="#{event.rawPosition}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                        <h:outputText value="Pax Position: " />
                        <p:commandLink oncomplete="PF('paxDetailsOP').show()" update="paxDetails">
                            <h:outputText value="#{event.paxPosition}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                        <h:outputText value="Best Run Number:" />
                        <h:outputText value="#{event.bestRunNumber}" />
                        <h:outputText value="Cones Killed:" />
                        <h:outputText value="#{event.conesKilled}" />
                        <h:outputText value="Best Time Ignoring Cones:" />
                        <p:commandLink oncomplete="PF('noConesDetailsOP').show()" update="noConesDetails">
                            <h:outputText value="#{event.bestTimeIgnoringCones}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                    </p:panelGrid>

                </p:carousel>
                <p:overlayPanel widgetVar="classDetailsOP" showCloseIcon="true">
                    <p:outputPanel id="classDetails" >
                        <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.classTable}">
                            <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position" >
                              #{driver.position}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                                #{driver.driver}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car" >
                                #{driver.car}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time" >
                                #{driver.time}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                                #{driver.diff} (#{driver.leaderDiff})
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                </p:overlayPanel>

                <p:overlayPanel widgetVar="rawDetailsOP" showCloseIcon="true">
                    <p:outputPanel id="rawDetails" >
                        <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.rawTable}">
                            <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position">
                              #{driver.position}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                                #{driver.driver}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Class">
                                #{driver.cls}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car">
                                #{driver.car}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time">
                                #{driver.time}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                                #{driver.diff} (#{driver.leaderDiff})
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                </p:overlayPanel>

                <p:overlayPanel widgetVar="paxDetailsOP" showCloseIcon="true">
                    <p:outputPanel id="paxDetails" >
                        <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.paxTable}">
                            <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position">
                              #{driver.position}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                                #{driver.driver}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Class">
                                #{driver.cls}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car">
                                #{driver.car}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time">
                                #{driver.time}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                                #{driver.diff} (#{driver.leaderDiff})
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                </p:overlayPanel>
                
                <p:overlayPanel widgetVar="noConesDetailsOP" showCloseIcon="true">
                    <p:outputPanel id="noConesDetails" >
                        <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.noConesTable}">
                            <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position">
                              #{driver.position}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                                #{driver.driver}
                            </p:column>
                            <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Class">
                                #{driver.cls}
                            </p:column>
                            <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car">
                                #{driver.car}
                            </p:column>
                            <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Cones">
                                #{driver.cones}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time">
                                #{driver.time}
                            </p:column>
                            <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                                #{driver.diff} (#{driver.leaderDiff})
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                </p:overlayPanel>
            </p:layoutUnit>
        </p:layout>
    </h:body>
</html>

