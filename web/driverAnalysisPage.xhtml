<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Autocross DB</title>
    </h:head>
    <h:body>
        <f:facet name="last">
            <h:outputStylesheet name="css/autoxDbMainStyle.css"  />
        </f:facet>
        <p:layout fullPage="true">
            <p:layoutUnit position="north" size="100">
                <p:tabMenu activeIndex="#{param.i}">
                    <p:menuitem value="Home" outcome="index">
                        <f:param name="i" value="0"/>
                    </p:menuitem>
                    <p:menuitem value="Event Info" outcome="eventInfoPage">
                        <f:param name="i" value="1"/>
                    </p:menuitem>
                    <p:menuitem value="New Event" outcome="loadEventPage">
                        <f:param name="i" value="2"/>
                    </p:menuitem>
                    <p:menuitem value="Chart" outcome="comparisonChart">
                        <f:param name="i" value="3" />
                    </p:menuitem>
                    <p:menuitem value="Awards" outcome="awardsPage" >
                        <f:param name="i" value="4" />
                    </p:menuitem>
                    <p:menuitem value="Analysis" outcome="driverAnalysisPage" >
                        <f:param name="i" value="5" />
                    </p:menuitem>
                </p:tabMenu> 
            </p:layoutUnit>
            <p:layoutUnit position="west" size="400">
                <h:form id="analysisForm">
                    <p:panelGrid columns="2" styleClass="noOutlinePanelGrid">
                        <p:outputLabel value="Driver:" />
                        <p:autoComplete id="driver" forceSelection="true" required="true" value="#{driverAnalysis.driver}" completeMethod="#{driverAnalysis.completeDriverText}" />
                        <p:outputLabel value="Start Date:" />
                        <p:calendar id="start" mode="popup" required="true" value="#{driverAnalysis.startDate}" />
                        <p:outputLabel value="End Date:" />
                        <p:calendar id="end" mode="popup" required="true" value="#{driverAnalysis.endDate}" />
                        <p:commandButton id="analyzeButton" onclick="PF('pbAjax').start();PF('analyzeButton').disable();" widgetVar="analyzeButton" value="Analyze" update="analysisForm analysisCarousel" action="#{driverAnalysis.analyzeDriver}" />
                    </p:panelGrid>
                    <p:progressBar id="progressBar" labelTemplate="{value}%" ajax="true" interval="500" widgetVar="pbAjax" value="#{driverAnalysis.progress}" style="width:300px" >
                        <p:ajax event="complete" listener="#{driverAnalysis.onCompleteLoad}" oncomplete="PF('analyzeButton').enable();PF('averagesOP').show()" update="progressBar averages" />
                    </p:progressBar>
                </h:form>
            </p:layoutUnit>
            <p:layoutUnit position="south" size="450">
                <p:carousel id="analysisCarousel" value="#{driverAnalysis.events}" var="event" numVisible="3" responsive="true" headerText="#{driverAnalysis.driver ne null and driverAnalysis.driver ne '' ? 'Events for '.concat(driverAnalysis.driver) : ''}" >
                    <p:panelGrid columns="2" columnClasses="descriptionColumn">
                        <h:outputText value="Event: " />
                        <h:outputText value="#{event.eventName}" />
                        <h:outputText value="Your Car: " />
                        <h:outputText value="#{event.carName}" />
                        <h:outputText value="Your Class: " />
                        <h:outputText value="#{event.className}" />
                        <h:outputText value="Class Position: " />
                        <p:commandLink oncomplete="PF('classDetailsOP').show();PF('rawDetailsOP').hide();PF('paxDetailsOP').hide();PF('noConesDetailsOP').hide()" update="classDetails">
                            <h:outputText value="#{event.classPosition}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                        <h:outputText value="Class Percentile:" />
                        <h:outputText value="#{event.classPercent}%" />
                        <h:outputText value="Raw Position: " />
                        <p:commandLink oncomplete="PF('classDetailsOP').hide();PF('rawDetailsOP').show();PF('paxDetailsOP').hide();PF('noConesDetailsOP').hide()" update="rawDetails">
                            <h:outputText value="#{event.rawPosition}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                        <h:outputText value="Raw Percentile:" />
                        <h:outputText value="#{event.rawPercent}%" />
                        <h:outputText value="Pax Position: " />
                        <p:commandLink oncomplete="PF('classDetailsOP').hide();PF('rawDetailsOP').hide();PF('paxDetailsOP').show();PF('noConesDetailsOP').hide()" update="paxDetails">
                            <h:outputText value="#{event.paxPosition}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                        <h:outputText value="Pax Percentile:" />
                        <h:outputText value="#{event.paxPercent}%" />
                        <h:outputText value="Best Run Number:" />
                        <h:outputText value="#{event.bestRunNumber}" />
                        <h:outputText value="Cones Killed:" />
                        <h:outputText value="#{event.conesKilled}" />
                        <h:outputText value="Best Time Ignoring Cones:" />
                        <p:commandLink oncomplete="PF('classDetailsOP').hide();PF('rawDetailsOP').hide();PF('paxDetailsOP').hide();PF('noConesDetailsOP').show()" update="noConesDetails">
                            <h:outputText value="#{event.bestTimeIgnoringCones}" />
                            <f:setPropertyActionListener value="#{event}" target="#{driverAnalysis.selectedEvent}" />
                        </p:commandLink>
                    </p:panelGrid>

                </p:carousel>
            </p:layoutUnit>
            <p:layoutUnit position="east" size="400">
                <p:overlayPanel id="averages" dismissable="false" widgetVar="averagesOP">
                    <p:panelGrid columns="2" >
                        <h:outputText value="Average Class Percentile:" />
                        <h:outputText value="#{driverAnalysis.avgClassPercent}%" />
                        <h:outputText value="Average Raw Percentile:" />
                        <h:outputText value="#{driverAnalysis.avgRawPercent}%" />
                        <h:outputText value="Average Pax Percentile:" />
                        <h:outputText value="#{driverAnalysis.avgPaxPercent}%" />
                        <h:outputText value="Average Cones Hit:" />
                        <h:outputText value="#{driverAnalysis.avgCones}" />
                        <h:outputText value="Average Best Run Number:" />
                        <h:outputText value="#{driverAnalysis.avgBestRun}" />
                    </p:panelGrid>
                </p:overlayPanel>
            </p:layoutUnit>
            <p:layoutUnit position="center">
                <p:overlayPanel id="classDetails" dismissable="false" widgetVar="classDetailsOP" >
                    <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.classTable}" styleClass="analysisDataTable">
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position" >
                          #{driver.position}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                            #{driver.driver}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car" >
                            #{driver.car}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time" >
                            #{driver.time}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                            #{driver.diff} (#{driver.leaderDiff})
                        </p:column>
                    </p:dataTable>
                </p:overlayPanel>

                <p:overlayPanel id="rawDetails" dismissable="false" widgetVar="rawDetailsOP" >
                    <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.rawTable}" styleClass="analysisDataTable">
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position">
                          #{driver.position}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                            #{driver.driver}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Class">
                            #{driver.cls}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car">
                            #{driver.car}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time">
                            #{driver.time}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                            #{driver.diff} (#{driver.leaderDiff})
                        </p:column>
                    </p:dataTable>
                </p:overlayPanel>

                <p:overlayPanel id="paxDetails" dismissable="false" widgetVar="paxDetailsOP" >
                    <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.paxTable}" styleClass="analysisDataTable">
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position">
                          #{driver.position}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                            #{driver.driver}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Class">
                            #{driver.cls}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car">
                            #{driver.car}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time">
                            #{driver.time}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                            #{driver.diff} (#{driver.leaderDiff})
                        </p:column>
                    </p:dataTable>
                </p:overlayPanel>
                
                <p:overlayPanel id="noConesDetails" dismissable="false" widgetVar="noConesDetailsOP" >
                    <p:dataTable var="driver" value="#{driverAnalysis.selectedEvent.noConesTable}" styleClass="analysisDataTable">
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Position">
                          #{driver.position}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Driver">
                            #{driver.driver}
                        </p:column>
                        <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Class">
                            #{driver.cls}
                        </p:column>
                        <p:column colspan="3" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Car">
                            #{driver.car}
                        </p:column>
                        <p:column colspan="1" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Cones">
                            #{driver.cones}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Best Time">
                            #{driver.time}
                        </p:column>
                        <p:column colspan="2" styleClass="#{driver.driver eq driverAnalysis.driver ? 'ourDriverRow' : null}" headerText="Time Difference" >
                            #{driver.diff} (#{driver.leaderDiff})
                        </p:column>
                    </p:dataTable>
                </p:overlayPanel>
            </p:layoutUnit>
        </p:layout>
    </h:body>
</html>

